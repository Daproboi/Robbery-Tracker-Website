<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robbery Tracker | Multi-Server</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #0b0e14;
            --card-bg: #161b22;
            --border: #30363d;
            --text-main: #ffffff;
            --text-dim: #8b949e;
            --green: #238636;
            --orange: #d29922;
            --red: #f85149;
            --blue: #58a6ff;
        }

        body { 
            background-color: var(--bg-dark); 
            color: var(--text-main); 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; 
            padding: 20px;
            margin: 0;
        }

        h1 { border-bottom: 1px solid var(--border); padding-bottom: 15px; margin-bottom: 25px; }

        .filter-bar { 
            display: flex; 
            gap: 8px; 
            margin-bottom: 30px; 
            flex-wrap: wrap; 
        }

        .filter-btn { 
            background: #1c1f26; border: 1px solid var(--border); color: var(--text-main); 
            padding: 8px 16px; border-radius: 6px; cursor: pointer; 
            font-size: 13px; font-weight: 600; transition: 0.2s;
        }
        .filter-btn:hover { background: #30363d; border-color: #8b949e; }
        .filter-btn.active { border-color: var(--green); background: #23863622; }

        .container { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 20px; 
        }
        
        .card { 
            background: var(--card-bg); 
            border-radius: 10px; 
            padding: 20px; 
            border: 1px solid var(--border); 
            position: relative;
            transition: transform 0.1s;
        }
        .card:hover { border-color: #444c56; transform: translateY(-2px); }

        .card h3 { margin: 0 0 15px 0; font-size: 18px; display: flex; justify-content: space-between; align-items: center; }
        
        .status { padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 800; text-transform: uppercase; }
        .open { background: var(--green); color: white; }
        .robbing { background: var(--orange); color: black; }
        .in-progress { background: var(--blue); color: white; }
        .double-bank { background: var(--red); color: white; }

        .info-text { font-size: 11px; font-weight: 700; margin-bottom: 10px; display: block; }

        /* JOIN BUTTON STYLES */
        .join-btn { 
            width: 100%; 
            background: var(--green); 
            color: white; 
            border: none; 
            padding: 12px; 
            border-radius: 6px; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 14px; 
            margin-top: 10px; 
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px; /* Space between icon and text */
        }
        .join-btn:hover { background: #2ea043; }
        
        .redirect-icon {
            width: 16px;
            height: 16px;
            fill: currentColor; /* Inherits the white color from the button */
        }

        .stats-row { 
            display: flex; 
            justify-content: space-between; 
            color: var(--text-dim); 
            font-size: 13px; 
            margin-top: 15px; 
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }
        
        .time-ago { color: var(--text-dim); font-size: 11px; margin-bottom: 8px; display: block; }
    </style>
</head>
<body>

    <h1>ðŸš¨ Live Robbery Snipers</h1>

    <div class="filter-bar" id="filters">
        <button class="filter-btn active" onclick="setFilter('all', this)">All</button>
        <button class="filter-btn" onclick="setFilter('Jewelry', this)">Jewelry</button>
        <button class="filter-btn" onclick="setFilter('Bank', this)">Bank</button>
        <button class="filter-btn" onclick="setFilter('Bank Truck', this)">Bank Truck</button>
        <button class="filter-btn" onclick="setFilter('Museum', this)">Museum</button>
        <button class="filter-btn" onclick="setFilter('PowerPlant', this)">PowerPlant</button>
        <button class="filter-btn" onclick="setFilter('Casino', this)">Casino</button>
        <button class="filter-btn" onclick="setFilter('Mansion', this)">Mansion</button>
        <button class="filter-btn" onclick="setFilter('Tomb', this)">Tomb</button>
        <button class="filter-btn" onclick="setFilter('Airdrop', this)">Airdrops</button>
    </div> 
    
    <div class="container" id="card-container"></div>

    <script>
        const FIREBASE_URL = "https://robbery-tracker-d43c5-default-rtdb.firebaseio.com/robberies.json";
        let currentFilter = 'all';

        function checkAutoJoin() {
            const urlParams = new URLSearchParams(window.location.search);
            const jobId = urlParams.get('jobid');
            const placeId = 606849621; 
            if (jobId) {
                window.location.href = `roblox://experiences/start?placeId=${placeId}&gameInstanceId=${jobId}`;
            }
        }

        function setFilter(type, btn) {
            currentFilter = type;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            fetchRobberies();
        }

        function getTimeAgo(timestamp) {
            const seconds = Math.floor(Date.now() / 1000) - timestamp;
            if (seconds < 60) return "Just now";
            return `${Math.floor(seconds / 60)}m ago`;
        }

        async function fetchRobberies() {
            try {
                const response = await fetch(FIREBASE_URL);
                const data = await response.json();
                const container = document.getElementById('card-container');
                
                if (!data) {
                    container.innerHTML = "<p style='color: #8b949e;'>Waiting for bots...</p>";
                    return;
                }

                const now = Math.floor(Date.now() / 1000);
                let robberies = [];

                Object.keys(data).forEach(key => {
                    const rob = data[key];
                    if (rob && rob.lastUpdated && (now - rob.lastUpdated) < 300) {
                        robberies.push({
                            ...rob,
                            uniqueId: key,
                            jobId: rob.jobId || key.split('_')[0]
                        });
                    }
                });

                if (currentFilter !== 'all') {
                    if (currentFilter === 'Bank') {
                        robberies = robberies.filter(r => r.name === "Bank");
                    } else {
                        robberies = robberies.filter(r => r.name.toLowerCase().includes(currentFilter.toLowerCase()));
                    }
                }

                robberies.sort((a, b) => b.lastUpdated - a.lastUpdated);
                displayCards(robberies);
            } catch (error) { console.error("Error fetching:", error); }
        }

        function displayCards(robberies) {
            const container = document.getElementById('card-container');
            container.innerHTML = ""; 

            robberies.forEach(rob => {
                let statusClass = rob.status === "Open" ? "open" : "robbing";
                let statusText = rob.status === "Open" ? "Open" : "IN ROBBERY";
                let extraInfoHtml = "";

                if (rob.region && rob.region !== "") {
                    extraInfoHtml += `<span class="info-text" style="color: #ff9d00">Location: ${rob.region}</span>`;
                }

                if (rob.isDouble) {
                    statusClass = "double-bank";
                    statusText = "DOUBLE BANK";
                    if (rob.bank1Status && rob.bank2Status) {
                        extraInfoHtml += `<span class="info-text" style="color: var(--orange)">Rising: ${rob.bank1Status} | Crater: ${rob.bank2Status}</span>`;
                    }
                }

                if (rob.name.toLowerCase().includes("airdrop")) {
                    const state = rob.dropStatus || rob.status || "Unopened";
                    statusText = state.toUpperCase();
                    
                    if (state === "In Progress") {
                        statusClass = "in-progress";
                        const timeLeft = rob.timerText || "0 seconds";
                        extraInfoHtml += `<span class="info-text" style="color: var(--blue)">Time Remaining: ${timeLeft}</span>`;
                    } else {
                        statusClass = "open";
                        extraInfoHtml += `<span class="info-text" style="color: var(--green)">Status: Ready to open</span>`;
                    }
                }

                // ICON SVG STRING
                const redirectIcon = `<svg class="redirect-icon" viewBox="0 0 24 24"><path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" /></svg>`;

                container.innerHTML += `
                    <div class="card">
                        <span class="time-ago">ðŸ•’ Updated ${getTimeAgo(rob.lastUpdated)}</span>
                        <h3>
                            ${rob.name} 
                            <span class="status ${statusClass}">${statusText}</span>
                        </h3>
                        ${extraInfoHtml}
                        <button class="join-btn" onclick="joinServer('${rob.jobId}')">
                            ${redirectIcon} JOIN GAME
                        </button>
                        <div class="stats-row">
                            <span>Players:</span>
                            <span><b>${rob.players || "?"} / 30</b></span>
                        </div>
                    </div>
                `;
            });
        }

        function joinServer(jobId) {
            const cleanJobId = jobId.split('_')[0];
            window.location.href = `roblox://experiences/start?placeId=606849621&gameInstanceId=${cleanJobId}`;
        }

        checkAutoJoin();
        setInterval(fetchRobberies, 3000);
        fetchRobberies();
    </script>
</body>
</html>
