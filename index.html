<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robbery Tracker | Multi-Server</title>
    <style>
        :root {
            --bg-dark: #0b0e14;
            --card-bg: #161b22;
            --border: #30363d;
            --text-main: #ffffff;
            --text-dim: #8b949e;
            --green: #238636;
            --orange: #d29922;
        }

        body { 
            background-color: var(--bg-dark); 
            color: var(--text-main); 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; 
            padding: 20px;
            margin: 0;
        }

        h1 { border-bottom: 1px solid var(--border); padding-bottom: 15px; margin-bottom: 25px; }

        .filter-bar { 
            display: flex; 
            gap: 8px; 
            margin-bottom: 30px; 
            flex-wrap: wrap; 
        }

        .filter-btn { 
            background: #1c1f26; border: 1px solid var(--border); color: var(--text-main); 
            padding: 8px 16px; border-radius: 6px; cursor: pointer; 
            font-size: 13px; font-weight: 600; transition: 0.2s;
        }
        .filter-btn:hover { background: #30363d; border-color: #8b949e; }
        .filter-btn.active { border-color: var(--green); background: #23863622; }

        .container { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
            gap: 20px; 
        }
        
        .card { 
            background: var(--card-bg); 
            border-radius: 10px; 
            padding: 20px; 
            border: 1px solid var(--border); 
            position: relative;
            transition: transform 0.1s;
        }
        .card:hover { border-color: #444c56; }

        .card h3 { margin: 0 0 15px 0; font-size: 18px; display: flex; justify-content: space-between; align-items: center; }
        
        .status { padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 800; text-transform: uppercase; }
        .open { background: var(--green); color: white; }
        .robbing { background: var(--orange); color: black; }

        .join-btn { 
            width: 100%; background: var(--green); color: white; border: none; 
            padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; 
            font-size: 14px; margin-top: 10px; transition: 0.2s;
        }
        .join-btn:hover { background: #2ea043; }

        .stats-row { 
            display: flex; 
            justify-content: space-between; 
            color: var(--text-dim); 
            font-size: 13px; 
            margin-top: 15px; 
            padding-top: 10px;
            border-top: 1px solid var(--border);
        }
        
        .time-ago { color: var(--text-dim); font-size: 11px; margin-bottom: 8px; display: block; }
    </style>
</head>
<body>

    <h1>ðŸš¨ Live Robbery Snipers</h1>

    <div class="filter-bar" id="filters">
        <button class="filter-btn active" onclick="setFilter('all', this)">All</button>
        <button class="filter-btn" onclick="setFilter('Jewelry', this)">Jewelry</button>
        <button class="filter-btn" onclick="setFilter('Bank', this)">Bank</button>
        <button class="filter-btn" onclick="setFilter('Museum', this)">Museum</button>
        <button class="filter-btn" onclick="setFilter('PowerPlant', this)">PowerPlant</button>
        <button class="filter-btn" onclick="setFilter('Casino', this)">Casino</button>
        <button class="filter-btn" onclick="setFilter('Mansion', this)">Mansion</button>
        <button class="filter-btn" onclick="setFilter('Tomb', this)">Tomb</button>
        <button class="filter-btn" onclick="setFilter('Airdrop', this)">Airdrops</button>
    </div> 
    
    <div class="container" id="card-container">
    </div>

    <script>
        const FIREBASE_URL = "https://robbery-tracker-d43c5-default-rtdb.firebaseio.com/robberies.json";
        let currentFilter = 'all';

        // --- NEW AUTO-JOIN FEATURE ---
        function checkAutoJoin() {
            const urlParams = new URLSearchParams(window.location.search);
            const jobId = urlParams.get('jobid');
            const placeId = 606849621; // Jailbreak PlaceID

            if (jobId) {
                console.log("Detecting JobId from link, launching Roblox...");
                window.location.href = `roblox://experiences/start?placeId=${placeId}&gameInstanceId=${jobId}`;
            }
        }

        function setFilter(type, btn) {
            currentFilter = type;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            fetchRobberies();
        }

        function getTimeAgo(timestamp) {
            const seconds = Math.floor(Date.now() / 1000) - timestamp;
            if (seconds < 60) return "Just now";
            const mins = Math.floor(seconds / 60);
            return `${mins}m ago`;
        }

        async function fetchRobberies() {
            try {
                const response = await fetch(FIREBASE_URL);
                const data = await response.json();
                
                const container = document.getElementById('card-container');
                
                if (!data) {
                    container.innerHTML = "<p style='color: #8b949e;'>Waiting for bots to find robberies...</p>";
                    return;
                }

                let robberies = Object.keys(data).map(key => ({
                    ...data[key],
                    jobId: data[key].jobId || key
                }));

                const now = Math.floor(Date.now() / 1000);
                robberies = robberies.filter(r => (now - r.lastUpdated) < 600);

                if (currentFilter !== 'all') {
                    robberies = robberies.filter(r => r.name.toLowerCase().includes(currentFilter.toLowerCase()));
                }

                robberies.sort((a, b) => b.lastUpdated - a.lastUpdated);

                displayCards(robberies);
            } catch (error) {
                console.error("Firebase Error:", error);
            }
        }

        function displayCards(robberies) {
            const container = document.getElementById('card-container');
            container.innerHTML = ""; 

            if (robberies.length === 0) {
                container.innerHTML = "<p style='color: #8b949e;'>No active robberies for this category.</p>";
                return;
            }

            robberies.forEach(rob => {
                const isStatusOpen = rob.status === "Open";
                const statusClass = isStatusOpen ? "open" : "robbing";
                const statusText = isStatusOpen ? "Open" : "Robbing";
                
                const playerDisplay = typeof rob.players === "number" ? rob.players : (rob.players ? rob.players.split('/')[0] : "?");

                container.innerHTML += `
                    <div class="card">
                        <span class="time-ago">ðŸ•’ Updated ${getTimeAgo(rob.lastUpdated)}</span>
                        <h3>
                            ${rob.name} 
                            <span class="status ${statusClass}">${statusText}</span>
                        </h3>
                        
                        <button class="join-btn" onclick="joinServer('${rob.jobId}')">JOIN SERVER</button>
                        
                        <div class="stats-row">
                            <span>Players:</span>
                            <span><b>${playerDisplay} / 30</b></span>
                        </div>
                    </div>
                `;
            });
        }

        function joinServer(jobId) {
            const placeId = 606849621;
            window.location.href = `roblox://experiences/start?placeId=${placeId}&gameInstanceId=${jobId}`;
        }

        // Initialize
        checkAutoJoin(); // Check for jobid link immediately on load
        setInterval(fetchRobberies, 3000);
        fetchRobberies();
    </script>
</body>
</html>
