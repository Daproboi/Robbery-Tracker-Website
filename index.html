<!DOCTYPE html>
<html>
<head>
    <title>My Robbery Tracker</title>
    <style>
        body { background-color: #0b0e14; color: white; font-family: sans-serif; padding: 20px; }
        
        .filter-bar { 
            display: flex; 
            gap: 8px; 
            margin-bottom: 30px; 
            flex-wrap: wrap; 
            align-items: flex-start; 
        }

        .filter-btn { 
            background: #1c1f26; border: 1px solid #30363d; color: white; 
            padding: 8px 14px; border-radius: 6px; cursor: pointer; 
            font-size: 13px; font-weight: 500; transition: 0.2s;
        }
        .filter-btn:hover { background: #30363d; border-color: #8b949e; }

        .container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        
        .card { background: #161b22; border-radius: 8px; padding: 20px; border: 1px solid #30363d; position: relative; }
        .card h3 { margin-top: 0; display: flex; justify-content: space-between; font-size: 18px; align-items: center; }
        
        .status { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .open { background: #238636; color: white; }
        .robbing { background: #d29922; color: black; }

        .join-btn { 
            width: 100%; background: #238636; color: white; border: none; 
            padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; margin-top: 15px;
            font-size: 14px;
        }
        .join-btn:hover { background: #2ea043; }

        .copy-btn {
            width: 100%; background: #30363d; color: white; border: 1px solid #444c56; 
            padding: 8px; border-radius: 5px; font-size: 11px; cursor: pointer; margin-top: 8px;
            text-transform: uppercase; letter-spacing: 0.5px;
        }

        .stats-row { display: flex; justify-content: space-between; color: #8b949e; font-size: 12px; margin-top: 12px; }
        .time-ago { color: #8b949e; font-size: 12px; text-align: right; display: block; margin-bottom: 5px; }
    </style>
</head>
<body>

    <h1>ðŸš¨ Live Robbery Snipers</h1>

    <div class="filter-bar">
        <button class="filter-btn" onclick="currentFilter = 'all'; fetchRobberies();">All</button>
        <button class="filter-btn" onclick="currentFilter = 'Jewelry Store'; fetchRobberies();">Jewelry</button>
        <button class="filter-btn" onclick="currentFilter = 'Bank'; fetchRobberies();">Bank</button>
        <button class="filter-btn" onclick="currentFilter = 'Museum'; fetchRobberies();">Museum</button>
        <button class="filter-btn" onclick="currentFilter = 'PowerPlant'; fetchRobberies();">PowerPlant</button>
        <button class="filter-btn" onclick="currentFilter = 'Casino'; fetchRobberies();">Casino</button>
        <button class="filter-btn" onclick="currentFilter = 'Cargo Train'; fetchRobberies();">Cargo Train</button>
        <button class="filter-btn" onclick="currentFilter = 'Tomb'; fetchRobberies();">Tomb</button>
        <button class="filter-btn" onclick="currentFilter = 'Mansion'; fetchRobberies();">Mansion</button>
        <button class="filter-btn" onclick="currentFilter = 'Airdrop'; fetchRobberies();">Airdrops</button>
    </div> 
    
    <div class="container" id="card-container"></div>

    <script>
        const FIREBASE_URL = "https://robbery-tracker-d43c5-default-rtdb.firebaseio.com/robberies.json";
        let currentFilter = 'all';

        function getTimeAgo(timestamp) {
            const seconds = Math.floor(Date.now() / 1000) - timestamp;
            if (seconds < 60) return "less than a minute ago";
            return Math.floor(seconds / 60) + " minutes ago";
        }

        async function fetchRobberies() {
            try {
                const response = await fetch(FIREBASE_URL);
                const data = await response.json();
                if (data) {
                    let robberyArray = Object.values(data);
                    if (currentFilter !== 'all') {
                        robberyArray = robberyArray.filter(r => r.name.includes(currentFilter));
                    }
                    displayCards(robberyArray);
                }
            } catch (error) { console.error(error); }
        }

        function displayCards(data) {
            const container = document.getElementById('card-container');
            container.innerHTML = ""; 

            data.sort((a, b) => b.lastUpdated - a.lastUpdated).forEach(rob => {
                const statusClass = rob.status === "Open" ? "open" : "robbing";
                const displayStatus = rob.status === "Open" ? "Open" : "In Robbery";
                
                container.innerHTML += `
                    <div class="card">
                        <span class="time-ago">ðŸ•’ ${getTimeAgo(rob.lastUpdated)}</span>
                        <h3>${rob.name} <span class="status ${statusClass}">${displayStatus}</span></h3>
                        
                        <div class="stats-row">
                            <span>Criminals: ${rob.criminals || 0}</span>
                            <span>Police: ${rob.police || 0}</span>
                        </div>

                        <button class="join-btn" onclick="joinServer('${rob.jobId}')">JOIN GAME</button>
                        <button class="copy-btn" onclick="copyId('${rob.jobId}', this)">Copy Job ID</button>
                        
                        <div class="stats-row" style="margin-top:10px; border-top: 1px solid #30363d; padding-top: 8px;">
                            <span>ðŸ‘¥ Total Players: ${rob.players}/30</span>
                        </div>
                    </div>
                `;
            });
        }

        function joinServer(jobId) {
            const jailbreakPlaceId = 606849621;
            const secretUrl = `roblox://experiences/start?placeId=${jailbreakPlaceId}&gameInstanceId=${jobId}`;
            const launchWindow = window.open(secretUrl, '_blank');
            setTimeout(() => { if (launchWindow) launchWindow.close(); }, 500);
        }

        function copyId(id, btn) {
            navigator.clipboard.writeText(id).then(() => {
                const oldText = btn.innerText;
                btn.innerText = "âœ… COPIED!";
                setTimeout(() => btn.innerText = oldText, 2000);
            });
        }

        setInterval(fetchRobberies, 5000);
        fetchRobberies();
    </script>
</body>
</html>

