<!DOCTYPE html>
<html>
<head>
    <title>My Robbery Tracker</title>
    <style>
        /* CSS: Making it look like Muffin Hook */
        body { background-color: #0b0e14; color: white; font-family: sans-serif; padding: 20px; }
        
        .filter-bar { display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; }
        .filter-btn { 
            background: #1c1f26; border: 1px solid #30363d; color: white; 
            padding: 8px 15px; border-radius: 5px; cursor: pointer; 
        }
        .filter-btn:hover { background: #30363d; }

        .container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        
        .card { background: #161b22; border-radius: 8px; padding: 20px; border: 1px solid #30363d; position: relative; }
        .card h3 { margin-top: 0; display: flex; justify-content: space-between; font-size: 18px; }
        
        .status { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .open { background: #238636; color: white; }
        .robbing { background: #d29922; color: black; }

        .join-btn { 
            width: 100%; background: #238636; color: white; border: none; 
            padding: 10px; border-radius: 5px; font-weight: bold; cursor: pointer; margin: 15px 0;
        }
        .join-btn:hover { background: #2ea043; }
        
        .stats { color: #8b949e; font-size: 14px; line-height: 1.6; }
        .expiry { font-size: 11px; color: #f85149; font-weight: bold; }
    </style>
</head>
<body>

    <h1>üö® Live Robbery Snipers</h1>

    <div class="filter-bar">
        <button class="filter-btn" onclick="currentFilter = 'all'; fetchRobberies();">All</button>
        <button class="filter-btn" onclick="currentFilter = 'Jewelry Store'; fetchRobberies();">Jewelry</button>
        <button class="filter-btn" onclick="currentFilter = 'Bank'; fetchRobberies();">Bank</button>
        <button class="filter-btn" onclick="currentFilter = 'Museum'; fetchRobberies();">Museum</button>
    </div>

    <div class="container" id="card-container">
        <p style="color:gray;">Waiting for bot data...</p>
    </div>

    <script>
        const FIREBASE_URL = "https://robbery-tracker-d43c5-default-rtdb.firebaseio.com/robberies.json";
        let currentFilter = 'all';

        async function fetchRobberies() {
            try {
                const response = await fetch(FIREBASE_URL);
                const data = await response.json();
                
                if (data) {
                    // Convert Firebase object to array
                    let robberyArray = Object.values(data);
                    
                    // Apply Category Filter
                    if (currentFilter !== 'all') {
                        robberyArray = robberyArray.filter(r => r.name.includes(currentFilter));
                    }

                    displayCards(robberyArray);
                } else {
                    document.getElementById('card-container').innerHTML = "<p style='color:gray;'>No active robberies in database.</p>";
                }
            } catch (error) {
                console.error("Error fetching from Firebase:", error);
            }
        }

        function displayCards(data) {
            const container = document.getElementById('card-container');
            container.innerHTML = ""; 

            const currentTime = Math.floor(Date.now() / 1000);
            const FIVE_MINUTES = 300; // 300 seconds

            data.forEach(rob => {
                const timePassed = currentTime - rob.lastUpdated;

                // ONLY show the card if it was updated less than 5 minutes ago
                if (timePassed < FIVE_MINUTES) {
                    const statusClass = rob.status === "Open" ? "open" : "robbing";
                    const timeLeft = Math.max(0, FIVE_MINUTES - timePassed);

                    container.innerHTML += `
                        <div class="card">
                            <h3>${rob.name} <span class="status ${statusClass}">${rob.status}</span></h3>
                            <button class="join-btn" onclick="joinServer('${rob.jobId}')">Join Game</button>
                            <div class="stats">
                                <p>üë• Players: ${rob.players}</p>
                                <p>üïí Last Seen: ${new Date(rob.lastUpdated * 1000).toLocaleTimeString()}</p>
                                <p class="expiry">üóëÔ∏è Auto-removing in: ${timeLeft}s</p>
                            </div>
                        </div>
                    `;
                }
            });

            if (container.innerHTML === "") {
                container.innerHTML = "<p style='color:gray; text-align:center;'>No fresh robberies found. Waiting for bot...</p>";
            }
        }

        function joinServer(jobId) {
            window.location.href = `roblox://placeId=244124012&gameInstanceId=${jobId}`;
        }

        // Refresh every 5 seconds to keep the timers and data live
        setInterval(fetchRobberies, 5000);
        fetchRobberies();
    </script>
</body>
</html>
