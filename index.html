<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robbery Tracker | Multi-Server</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0b0e14;
            --card-bg: #161b22;
            --border: #30363d;
            --text-main: #ffffff;
            --text-dim: #8b949e;
            --green: #238636;
            --green-hover: #2ea043;
            --orange: #d29922;
            --red: #f85149;
            --blue: #1f6feb;
        }

        body { 
            background-color: var(--bg-dark); 
            color: var(--text-main); 
            font-family: 'Inter', -apple-system, sans-serif; 
            padding: 40px;
            margin: 0;
        }

        /* --- Notification System --- */
        #notif-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .notification {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-left: 4px solid var(--blue);
            padding: 15px 20px;
            border-radius: 8px;
            min-width: 250px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
            animation: slideIn 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            font-size: 14px;
        }

        @keyframes slideIn {
            from { transform: translateX(120%); }
            to { transform: translateX(0); }
        }

        .notif-alert { border-left-color: var(--red); background: #f8514910; }
        .notif-drop { border-left-color: var(--orange); background: #d2992210; }

        /* --- UI Elements --- */
        h1 { 
            font-size: 28px; 
            font-weight: 800; 
            margin-bottom: 30px; 
            display: flex; 
            align-items: center; 
            gap: 12px;
        }

        .filter-bar { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 35px; 
            flex-wrap: wrap; 
        }

        .filter-btn { 
            background: #21262d; 
            border: 1px solid var(--border); 
            color: var(--text-main); 
            padding: 8px 18px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: 600; 
            transition: 0.2s;
        }

        .filter-btn:hover { background: var(--border); }
        .filter-btn.active { border-color: var(--green); background: #23863615; color: #44cf6c; }

        .container { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
            gap: 25px; 
        }
        
        .card { 
            background: var(--card-bg); 
            border-radius: 12px; 
            padding: 24px; 
            border: 1px solid var(--border); 
            position: relative;
        }

        .card h3 { 
            margin: 10px 0 20px 0; 
            font-size: 20px; 
            font-weight: 700;
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        
        .status { 
            padding: 4px 12px; 
            border-radius: 6px; 
            font-size: 12px; 
            font-weight: 800; 
            text-transform: uppercase; 
        }

        .open { background: #23863630; color: #44cf6c; border: 1px solid #238636; }
        .robbing { background: #d2992230; color: #e3b341; border: 1px solid #d29922; }
        .double { background: #f8514930; color: #ff7b72; border: 1px solid #f85149; animation: pulse 1.5s infinite; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .join-btn { 
            width: 100%; 
            background: var(--green); 
            color: white; 
            border: none; 
            padding: 14px; 
            border-radius: 8px; 
            font-weight: 700; 
            cursor: pointer; 
            font-size: 15px; 
            transition: 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .join-btn:hover { background: var(--green-hover); transform: translateY(-1px); }

        .stats-row { 
            display: flex; 
            justify-content: space-between; 
            color: var(--text-dim); 
            font-size: 14px; 
            margin-top: 20px;
        }
        
        .time-ago { 
            color: var(--text-dim); 
            font-size: 12px; 
            display: flex; 
            align-items: center; 
            gap: 6px;
        }
    </style>
</head>
<body>

    <div id="notif-container"></div>

    <h1>ðŸš¨ Live Robbery Snipers</h1>

    <div class="filter-bar" id="filters">
        <button class="filter-btn active" onclick="setFilter('all', this)">All</button>
        <button class="filter-btn" onclick="setFilter('Jewelry', this)">Jewelry</button>
        <button class="filter-btn" onclick="setFilter('Bank', this)">Bank</button>
        <button class="filter-btn" onclick="setFilter('Museum', this)">Museum</button>
        <button class="filter-btn" onclick="setFilter('PowerPlant', this)">PowerPlant</button>
        <button class="filter-btn" onclick="setFilter('Casino', this)">Casino</button>
        <button class="filter-btn" onclick="setFilter('Mansion', this)">Mansion</button>
        <button class="filter-btn" onclick="setFilter('Tomb', this)">Tomb</button>
        <button class="filter-btn" onclick="setFilter('Airdrop', this)">Airdrops</button>
    </div> 
    
    <div class="container" id="card-container"></div>

    <script>
        const FIREBASE_URL = "https://robbery-tracker-d43c5-default-rtdb.firebaseio.com/robberies.json";
        let currentFilter = 'all';
        let lastKnownData = {};

        function setFilter(type, btn) {
            currentFilter = type;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            fetchRobberies();
        }

        function pushNotify(title, text, styleClass = "") {
            const container = document.getElementById('notif-container');
            const notif = document.createElement('div');
            notif.className = `notification ${styleClass}`;
            notif.innerHTML = `<strong>${title}</strong><br>${text}`;
            container.appendChild(notif);

            // Auto-delete after 5 minutes
            setTimeout(() => {
                notif.style.opacity = '0';
                setTimeout(() => notif.remove(), 500);
            }, 300000);
        }

        function getTimeAgo(timestamp) {
            const seconds = Math.floor(Date.now() / 1000) - timestamp;
            if (seconds < 0) return "Just now"; // Handle slight clock desync
            if (seconds < 60) return "Just now";
            return `${Math.floor(seconds / 60)}m ago`;
        }

        async function fetchRobberies() {
            try {
                const response = await fetch(FIREBASE_URL);
                const data = await response.json();
                const container = document.getElementById('card-container');
                
                if (!data) return;

                let robberies = Object.keys(data).map(key => ({
                    ...data[key],
                    id: key
                }));

                // Logic for Notifications & State Monitoring
                robberies.forEach(rob => {
                    const oldState = lastKnownData[rob.id];
                    
                    // Trigger if status changes or new entry
                    if (!oldState || oldState.status !== rob.status) {
                        if (rob.status === "Open") {
                            if (rob.name.toLowerCase().includes("airdrop")) {
                                pushNotify("ðŸ“¦ AIRDROP", "A new airdrop has landed!", "notif-drop");
                            } else if (rob.isDouble) {
                                pushNotify("ðŸ”¥ DOUBLE BANK", "Double Bank detected! Join now!", "notif-alert");
                            } else {
                                pushNotify("ðŸ”“ " + rob.name.toUpperCase(), "Robbery is now OPEN", "");
                            }
                        }
                    }
                    lastKnownData[rob.id] = rob;
                });

                // Filter & Sort
                if (currentFilter !== 'all') {
                    robberies = robberies.filter(r => r.name.toLowerCase().includes(currentFilter.toLowerCase()));
                }
                robberies.sort((a, b) => b.lastUpdated - a.lastUpdated);

                // Display
                container.innerHTML = "";
                robberies.forEach(rob => {
                    const isDouble = rob.isDouble && rob.name.toLowerCase().includes("bank");
                    const statusClass = isDouble ? "double" : rob.status.toLowerCase();
                    const statusText = isDouble ? "Double Bank" : rob.status;

                    container.innerHTML += `
                        <div class="card">
                            <span class="time-ago">ðŸ•’ Updated ${getTimeAgo(rob.lastUpdated)}</span>
                            <h3>
                                ${rob.name} 
                                <span class="status ${statusClass}">${statusText}</span>
                            </h3>
                            <button class="join-btn" onclick="joinServer('${rob.jobId}')">Join Server</button>
                            <div class="stats-row">
                                <span>Population:</span>
                                <span><strong>${rob.players || "0"} / 30</strong></span>
                            </div>
                        </div>
                    `;
                });
            } catch (error) { console.log("Fetch Error:", error); }
        }

        function joinServer(jobId) {
            window.location.href = `roblox://experiences/start?placeId=606849621&gameInstanceId=${jobId}`;
        }

        // Check for updates every 3 seconds
        setInterval(fetchRobberies, 3000);
        fetchRobberies();
    </script>
</body>
</html>
